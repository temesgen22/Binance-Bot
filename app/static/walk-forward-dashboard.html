<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Walk-Forward Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="/static/auth.js"></script>
    <script src="/static/settings.js"></script>
    <script src="/static/utils.js"></script>
    <link rel="stylesheet" href="/static/common.css">
    <script src="/static/common.js"></script>
    <style>
        .container {
            max-width: 1600px;
        }

        .content {
            padding: 25px;
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .summary-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .summary-card .value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-card .sub-value {
            font-size: 0.85em;
            opacity: 0.8;
        }

        /* Filters Section */
        .filters-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
        }

        .filter-group input,
        .filter-group select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* Top Performers Table */
        .section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.5em;
        }

        .sort-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .sort-controls label {
            font-weight: 600;
            color: #555;
        }

        .sort-controls select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
        }

        .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .trades-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }

        .trades-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .trades-table tr:hover {
            background: #f8f9fa;
        }

        .positive {
            color: #28a745;
            font-weight: 600;
        }

        .negative {
            color: #dc3545;
            font-weight: 600;
        }

        /* Recommendations */
        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recommendation-card {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            position: relative;
        }

        .recommendation-card.best-overall {
            border-color: #ffc107;
            background: linear-gradient(135deg, #fff9e6 0%, #fff3cd 100%);
        }

        .recommendation-card.most-reliable {
            border-color: #28a745;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        }

        .recommendation-card.best-risk {
            border-color: #17a2b8;
            background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
        }

        .recommendation-card h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.2em;
        }

        .recommendation-card .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .recommendation-card .badge.best {
            background: #ffc107;
            color: #000;
        }

        .recommendation-card .badge.reliable {
            background: #28a745;
            color: white;
        }

        .recommendation-card .badge.risk {
            background: #17a2b8;
            color: white;
        }

        .recommendation-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .recommendation-metric {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }

        .recommendation-metric .label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
        }

        .recommendation-metric .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
        }

        .recommendation-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state p {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>üìä Walk-Forward Analysis Dashboard</h1>
                    <p>Comprehensive insights and recommendations from your analyses</p>
                </div>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <a href="/static/backtesting.html" style="color: white; text-decoration: none; padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 6px;">üîô Back to Backtesting</a>
                    <a href="/static/index.html" style="color: white; text-decoration: none;">üè† Home</a>
                    <a href="/dashboard" style="color: white; text-decoration: none;">üìä Dashboard</a>
                    <a href="/static/settings.html" style="color: white; text-decoration: none;">‚öôÔ∏è Settings</a>
                    <span id="user-info"></span>
                    <a href="#" onclick="logout(); return false;" class="logout-link" style="color: white;">üö™ Logout</a>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Filters Section -->
            <div class="filters-section">
                <h3 style="margin-bottom: 15px;">Filters</h3>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="filterSymbol">Symbol</label>
                        <input type="text" id="filterSymbol" placeholder="e.g., BTCUSDT" list="symbolsList">
                        <datalist id="symbolsList"></datalist>
                    </div>
                    <div class="filter-group">
                        <label for="filterStrategyType">Strategy Type</label>
                        <select id="filterStrategyType">
                            <option value="">All Strategies</option>
                            <option value="scalping">EMA Scalping</option>
                            <option value="reverse_scalping">Reverse Scalping (Contrarian)</option>
                            <option value="range_mean_reversion">Range Mean Reversion</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterStartDate">Start Date</label>
                        <input type="date" id="filterStartDate">
                    </div>
                    <div class="filter-group">
                        <label for="filterEndDate">End Date</label>
                        <input type="date" id="filterEndDate">
                    </div>
                </div>
                <div class="filter-actions">
                    <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                    <button class="btn btn-secondary" onclick="clearFilters()">Clear Filters</button>
                </div>
            </div>

            <!-- Summary Overview -->
            <div id="summarySection" class="section">
                <h2>Summary Overview</h2>
                <div id="summaryCards" class="summary-grid">
                    <div class="loading">Loading summary...</div>
                </div>
            </div>

            <!-- Recommendations -->
            <div id="recommendationsSection" class="section">
                <h2>Recommendations</h2>
                <div id="recommendationsCards" class="recommendations-grid">
                    <div class="loading">Loading recommendations...</div>
                </div>
            </div>

            <!-- Top Performers -->
            <div id="topPerformersSection" class="section">
                <h2>Top Performers</h2>
                <div class="sort-controls">
                    <label>Sort by:</label>
                    <select id="sortBy" onchange="loadTopPerformers()">
                        <option value="return">Total Return</option>
                        <option value="consistency">Consistency Score</option>
                        <option value="sharpe">Sharpe Ratio</option>
                    </select>
                </div>
                <div id="topPerformersTable">
                    <div class="loading">Loading top performers...</div>
                </div>
            </div>

            <!-- Performance Distribution -->
            <div id="distributionSection" class="section">
                <h2>Performance Distribution</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <h3 style="margin-bottom: 15px; font-size: 1.1em;">Return Distribution</h3>
                        <canvas id="returnDistributionChart" style="max-height: 300px;"></canvas>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 15px; font-size: 1.1em;">Performance Statistics</h3>
                        <div id="distributionStats" style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div class="loading">Loading statistics...</div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px; font-size: 1.1em;">Performance by Symbol & Strategy</h3>
                    <div id="heatmapContainer" style="overflow-x: auto;">
                        <div class="loading">Loading heatmap...</div>
                    </div>
                </div>
            </div>

            <!-- Parameter Insights -->
            <div id="parameterInsightsSection" class="section">
                <h2>Parameter Insights</h2>
                <div id="parameterInsightsContent">
                    <div class="loading">Loading parameter insights...</div>
                </div>
            </div>

            <!-- Trends Over Time -->
            <div id="trendsSection" class="section">
                <h2>Trends Over Time</h2>
                <div style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px; font-size: 1.1em;">Average Return Over Time</h3>
                    <canvas id="trendsChart" style="max-height: 400px;"></canvas>
                </div>
                <div style="margin-top: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <h3 style="margin-bottom: 15px; font-size: 1.1em;">By Strategy Type</h3>
                        <canvas id="strategyTrendsChart" style="max-height: 300px;"></canvas>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 15px; font-size: 1.1em;">By Symbol</h3>
                        <canvas id="symbolTrendsChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Comparison View -->
            <div id="comparisonSection" class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">Compare Analyses</h2>
                    <button class="btn btn-secondary btn-small" onclick="loadAnalysisListForComparison()" title="Refresh analysis list">üîÑ Refresh List</button>
                </div>
                <div style="margin-bottom: 20px;">
                    <p style="color: #666; margin-bottom: 15px;">Select 2-5 analyses from your history to compare side-by-side</p>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px; margin-bottom: 15px;">
                        <div class="filter-group">
                            <label for="compareAnalysis1">Analysis 1</label>
                            <select id="compareAnalysis1" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
                                <option value="">Select analysis...</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="compareAnalysis2">Analysis 2</label>
                            <select id="compareAnalysis2" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
                                <option value="">Select analysis...</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="compareAnalysis3">Analysis 3 (Optional)</label>
                            <select id="compareAnalysis3" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
                                <option value="">Select analysis...</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="compareAnalysis4">Analysis 4 (Optional)</label>
                            <select id="compareAnalysis4" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
                                <option value="">Select analysis...</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="compareAnalysis5">Analysis 5 (Optional)</label>
                            <select id="compareAnalysis5" style="padding: 8px; border: 2px solid #ddd; border-radius: 6px;">
                                <option value="">Select analysis...</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-primary" onclick="loadComparison()">Compare Selected Analyses</button>
                        <button class="btn btn-secondary" onclick="clearComparison()">Clear</button>
                    </div>
                </div>
                <div id="comparisonResults">
                    <div class="empty-state">
                        <p>Select at least 2 analyses from the dropdowns above to compare</p>
                        <p style="font-size: 0.85em; margin-top: 10px; color: #999;">
                            <strong>What gets compared?</strong><br>
                            ‚Ä¢ Total Return % | ‚Ä¢ Consistency Score | ‚Ä¢ Sharpe Ratio<br>
                            ‚Ä¢ Max Drawdown % | ‚Ä¢ Total Trades | ‚Ä¢ Win Rate<br>
                            ‚Ä¢ Total Windows | ‚Ä¢ Symbol | ‚Ä¢ Strategy Type | ‚Ä¢ Created Date
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        (function() {
            if (!requireAuth()) {
                throw new Error('Not authenticated');
            }
        })();

        let currentFilters = {
            symbol: null,
            strategy_type: null,
            start_date: null,
            end_date: null
        };

        // Chart instances
        let returnDistributionChart = null;
        let trendsChart = null;
        let strategyTrendsChart = null;
        let symbolTrendsChart = null;

        // Load dashboard data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadSymbols();
            loadSummary();
            loadRecommendations();
            loadTopPerformers();
            loadDistribution();
            loadParameterInsights();
            loadTrends();
            // Load comparison list with a small delay to ensure DOM is ready
            setTimeout(() => {
                loadAnalysisListForComparison();
            }, 100);
        });

        async function loadSymbols() {
            try {
                const response = await fetch('/api/logs/symbols');
                if (response.ok) {
                    const symbols = await response.json();
                    const datalist = document.getElementById('symbolsList');
                    datalist.innerHTML = '';
                    symbols.forEach(symbol => {
                        const option = document.createElement('option');
                        option.value = symbol;
                        datalist.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading symbols:', error);
            }
        }

        async function loadSummary() {
            try {
                const queryParams = new URLSearchParams();
                if (currentFilters.symbol) queryParams.append('symbol', currentFilters.symbol);
                if (currentFilters.strategy_type) queryParams.append('strategy_type', currentFilters.strategy_type);
                if (currentFilters.start_date) queryParams.append('start_date', currentFilters.start_date);
                if (currentFilters.end_date) queryParams.append('end_date', currentFilters.end_date);

                const response = await authFetch(`/api/backtesting/walk-forward/dashboard/summary?${queryParams}`);
                if (!response.ok) throw new Error('Failed to load summary');

                const data = await response.json();
                displaySummary(data);
            } catch (error) {
                console.error('Error loading summary:', error);
                document.getElementById('summaryCards').innerHTML = 
                    '<div class="empty-state"><p>Error loading summary data</p></div>';
            }
        }

        function displaySummary(data) {
            const container = document.getElementById('summaryCards');
            
            if (data.total_analyses === 0) {
                container.innerHTML = '<div class="empty-state"><p>No analyses found. Run some walk-forward analyses to see data here.</p></div>';
                return;
            }

            container.innerHTML = `
                <div class="summary-card">
                    <h3>Total Analyses</h3>
                    <div class="value">${data.total_analyses}</div>
                    <div class="sub-value">Analyses completed</div>
                </div>
                <div class="summary-card">
                    <h3>Best Return</h3>
                    <div class="value">${data.best_return ? data.best_return.total_return_pct.toFixed(2) + '%' : 'N/A'}</div>
                    <div class="sub-value">${data.best_return ? data.best_return.name : 'No data'}</div>
                </div>
                <div class="summary-card">
                    <h3>Most Consistent</h3>
                    <div class="value">${data.most_consistent ? data.most_consistent.consistency_score.toFixed(1) + '%' : 'N/A'}</div>
                    <div class="sub-value">${data.most_consistent ? data.most_consistent.name : 'No data'}</div>
                </div>
                <div class="summary-card">
                    <h3>Best Sharpe Ratio</h3>
                    <div class="value">${data.best_sharpe ? data.best_sharpe.sharpe_ratio.toFixed(2) : 'N/A'}</div>
                    <div class="sub-value">${data.best_sharpe ? data.best_sharpe.name : 'No data'}</div>
                </div>
                <div class="summary-card">
                    <h3>Average Return</h3>
                    <div class="value">${data.average_return.toFixed(2)}%</div>
                    <div class="sub-value">Across all analyses</div>
                </div>
                <div class="summary-card">
                    <h3>Success Rate</h3>
                    <div class="value">${data.success_rate.toFixed(1)}%</div>
                    <div class="sub-value">${data.positive_analyses} of ${data.total_analyses} profitable</div>
                </div>
            `;
        }

        async function loadRecommendations() {
            try {
                const queryParams = new URLSearchParams();
                if (currentFilters.symbol) queryParams.append('symbol', currentFilters.symbol);
                if (currentFilters.strategy_type) queryParams.append('strategy_type', currentFilters.strategy_type);
                if (currentFilters.start_date) queryParams.append('start_date', currentFilters.start_date);
                if (currentFilters.end_date) queryParams.append('end_date', currentFilters.end_date);

                const response = await authFetch(`/api/backtesting/walk-forward/dashboard/recommendations?${queryParams}`);
                if (!response.ok) throw new Error('Failed to load recommendations');

                const data = await response.json();
                displayRecommendations(data);
            } catch (error) {
                console.error('Error loading recommendations:', error);
                document.getElementById('recommendationsCards').innerHTML = 
                    '<div class="empty-state"><p>Error loading recommendations</p></div>';
            }
        }

        function displayRecommendations(data) {
            const container = document.getElementById('recommendationsCards');
            
            if (!data.best_overall && !data.most_reliable && !data.best_risk_adjusted) {
                container.innerHTML = '<div class="empty-state"><p>No recommendations available. Run some analyses first.</p></div>';
                return;
            }

            let html = '';

            if (data.best_overall) {
                html += `
                    <div class="recommendation-card best-overall">
                        <span class="badge best">üèÜ Best Overall</span>
                        <h3>${escapeHtml(data.best_overall.name)}</h3>
                        <p style="color: #666; margin-bottom: 10px;">
                            <strong>Symbol:</strong> ${escapeHtml(data.best_overall.symbol)} | 
                            <strong>Strategy:</strong> ${escapeHtml(data.best_overall.strategy_type)}
                        </p>
                        <div class="recommendation-metrics">
                            <div class="recommendation-metric">
                                <div class="label">Return</div>
                                <div class="value positive">${data.best_overall.total_return_pct.toFixed(2)}%</div>
                            </div>
                            <div class="recommendation-metric">
                                <div class="label">Consistency</div>
                                <div class="value">${data.best_overall.consistency_score.toFixed(1)}%</div>
                            </div>
                            <div class="recommendation-metric">
                                <div class="label">Sharpe</div>
                                <div class="value">${data.best_overall.sharpe_ratio ? data.best_overall.sharpe_ratio.toFixed(2) : 'N/A'}</div>
                            </div>
                            <div class="recommendation-metric">
                                <div class="label">Trades</div>
                                <div class="value">${data.best_overall.total_trades}</div>
                            </div>
                        </div>
                        <div class="recommendation-actions">
                            <button class="btn btn-primary btn-small" onclick="viewAnalysis('${data.best_overall.id}')">View Details</button>
                            <button class="btn btn-secondary btn-small" onclick="reuseConfig('${data.best_overall.id}')">Reuse Config</button>
                        </div>
                    </div>
                `;
            }

            if (data.most_reliable) {
                html += `
                    <div class="recommendation-card most-reliable">
                        <span class="badge reliable">‚úÖ Most Reliable</span>
                        <h3>${escapeHtml(data.most_reliable.name)}</h3>
                        <p style="color: #666; margin-bottom: 10px;">
                            <strong>Symbol:</strong> ${escapeHtml(data.most_reliable.symbol)} | 
                            <strong>Strategy:</strong> ${escapeHtml(data.most_reliable.strategy_type)}
                        </p>
                        <div class="recommendation-metrics">
                            <div class="recommendation-metric">
                                <div class="label">Return</div>
                                <div class="value ${data.most_reliable.total_return_pct >= 0 ? 'positive' : 'negative'}">${data.most_reliable.total_return_pct.toFixed(2)}%</div>
                            </div>
                            <div class="recommendation-metric">
                                <div class="label">Consistency</div>
                                <div class="value">${data.most_reliable.consistency_score.toFixed(1)}%</div>
                            </div>
                            <div class="recommendation-metric">
                                <div class="label">Sharpe</div>
                                <div class="value">${data.most_reliable.sharpe_ratio ? data.most_reliable.sharpe_ratio.toFixed(2) : 'N/A'}</div>
                            </div>
                            <div class="recommendation-metric">
                                <div class="label">Trades</div>
                                <div class="value">${data.most_reliable.total_trades}</div>
                            </div>
                        </div>
                        <div class="recommendation-actions">
                            <button class="btn btn-primary btn-small" onclick="viewAnalysis('${data.most_reliable.id}')">View Details</button>
                            <button class="btn btn-secondary btn-small" onclick="reuseConfig('${data.most_reliable.id}')">Reuse Config</button>
                        </div>
                    </div>
                `;
            }

            if (data.best_risk_adjusted) {
                html += `
                    <div class="recommendation-card best-risk">
                        <span class="badge risk">üìä Best Risk-Adjusted</span>
                        <h3>${escapeHtml(data.best_risk_adjusted.name)}</h3>
                        <p style="color: #666; margin-bottom: 10px;">
                            <strong>Symbol:</strong> ${escapeHtml(data.best_risk_adjusted.symbol)} | 
                            <strong>Strategy:</strong> ${escapeHtml(data.best_risk_adjusted.strategy_type)}
                        </p>
                        <div class="recommendation-metrics">
                            <div class="recommendation-metric">
                                <div class="label">Return</div>
                                <div class="value ${data.best_risk_adjusted.total_return_pct >= 0 ? 'positive' : 'negative'}">${data.best_risk_adjusted.total_return_pct.toFixed(2)}%</div>
                            </div>
                            <div class="recommendation-metric">
                                <div class="label">Consistency</div>
                                <div class="value">${data.best_risk_adjusted.consistency_score.toFixed(1)}%</div>
                            </div>
                            <div class="recommendation-metric">
                                <div class="label">Sharpe</div>
                                <div class="value">${data.best_risk_adjusted.sharpe_ratio.toFixed(2)}</div>
                            </div>
                            <div class="recommendation-metric">
                                <div class="label">Trades</div>
                                <div class="value">${data.best_risk_adjusted.total_trades}</div>
                            </div>
                        </div>
                        <div class="recommendation-actions">
                            <button class="btn btn-primary btn-small" onclick="viewAnalysis('${data.best_risk_adjusted.id}')">View Details</button>
                            <button class="btn btn-secondary btn-small" onclick="reuseConfig('${data.best_risk_adjusted.id}')">Reuse Config</button>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        async function loadTopPerformers() {
            try {
                const sortBy = document.getElementById('sortBy').value;
                const queryParams = new URLSearchParams();
                queryParams.append('limit', '10');
                queryParams.append('sort_by', sortBy);
                if (currentFilters.symbol) queryParams.append('symbol', currentFilters.symbol);
                if (currentFilters.strategy_type) queryParams.append('strategy_type', currentFilters.strategy_type);
                if (currentFilters.start_date) queryParams.append('start_date', currentFilters.start_date);
                if (currentFilters.end_date) queryParams.append('end_date', currentFilters.end_date);

                const response = await authFetch(`/api/backtesting/walk-forward/dashboard/top-performers?${queryParams}`);
                if (!response.ok) throw new Error('Failed to load top performers');

                const data = await response.json();
                displayTopPerformers(data.top_performers);
            } catch (error) {
                console.error('Error loading top performers:', error);
                document.getElementById('topPerformersTable').innerHTML = 
                    '<div class="empty-state"><p>Error loading top performers</p></div>';
            }
        }

        function displayTopPerformers(performers) {
            const container = document.getElementById('topPerformersTable');
            
            if (performers.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No top performers found</p></div>';
                return;
            }

            let html = `
                <table class="trades-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Symbol</th>
                            <th>Strategy</th>
                            <th>Return %</th>
                            <th>Consistency</th>
                            <th>Sharpe</th>
                            <th>Trades</th>
                            <th>Win Rate</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            performers.forEach(performer => {
                html += `
                    <tr>
                        <td><strong>#${performer.rank}</strong></td>
                        <td><strong>${escapeHtml(performer.name)}</strong></td>
                        <td>${escapeHtml(performer.symbol)}</td>
                        <td>${escapeHtml(performer.strategy_type)}</td>
                        <td class="${performer.total_return_pct >= 0 ? 'positive' : 'negative'}">${performer.total_return_pct.toFixed(2)}%</td>
                        <td>${performer.consistency_score.toFixed(1)}%</td>
                        <td>${performer.sharpe_ratio ? performer.sharpe_ratio.toFixed(2) : 'N/A'}</td>
                        <td>${performer.total_trades}</td>
                        <td>${performer.avg_win_rate.toFixed(1)}%</td>
                        <td>
                            <button class="btn btn-primary btn-small" onclick="viewAnalysis('${performer.id}')">View</button>
                            <button class="btn btn-secondary btn-small" onclick="reuseConfig('${performer.id}')">Reuse</button>
                        </td>
                    </tr>
                `;
            });

            html += `
                    </tbody>
                </table>
            `;

            container.innerHTML = html;
        }

        function applyFilters() {
            currentFilters.symbol = document.getElementById('filterSymbol').value.trim() || null;
            currentFilters.strategy_type = document.getElementById('filterStrategyType').value || null;
            currentFilters.start_date = document.getElementById('filterStartDate').value || null;
            currentFilters.end_date = document.getElementById('filterEndDate').value || null;

            loadSummary();
            loadRecommendations();
            loadTopPerformers();
            loadDistribution();
            loadParameterInsights();
            loadTrends();
        }

        function clearFilters() {
            document.getElementById('filterSymbol').value = '';
            document.getElementById('filterStrategyType').value = '';
            document.getElementById('filterStartDate').value = '';
            document.getElementById('filterEndDate').value = '';

            currentFilters = {
                symbol: null,
                strategy_type: null,
                start_date: null,
                end_date: null
            };

            loadSummary();
            loadRecommendations();
            loadTopPerformers();
            loadDistribution();
            loadParameterInsights();
            loadTrends();
        }

        function viewAnalysis(analysisId) {
            window.location.href = `/static/backtesting.html?view=${analysisId}`;
        }

        function reuseConfig(analysisId) {
            window.location.href = `/static/backtesting.html?reuse=${analysisId}`;
        }

        async function loadDistribution() {
            try {
                const queryParams = new URLSearchParams();
                if (currentFilters.symbol) queryParams.append('symbol', currentFilters.symbol);
                if (currentFilters.strategy_type) queryParams.append('strategy_type', currentFilters.strategy_type);
                if (currentFilters.start_date) queryParams.append('start_date', currentFilters.start_date);
                if (currentFilters.end_date) queryParams.append('end_date', currentFilters.end_date);

                const response = await authFetch(`/api/backtesting/walk-forward/dashboard/distribution?${queryParams}`);
                if (!response.ok) throw new Error('Failed to load distribution');

                const data = await response.json();
                displayDistribution(data);
            } catch (error) {
                console.error('Error loading distribution:', error);
            }
        }

        function displayDistribution(data) {
            // Return distribution chart
            const ctx = document.getElementById('returnDistributionChart');
            if (ctx && data.return_distribution) {
                if (returnDistributionChart) {
                    returnDistributionChart.destroy();
                }
                
                returnDistributionChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.return_distribution.map(d => d.range),
                        datasets: [{
                            label: 'Number of Analyses',
                            data: data.return_distribution.map(d => d.count),
                            backgroundColor: [
                                'rgba(220, 53, 69, 0.7)',  // Red for negative
                                'rgba(255, 193, 7, 0.7)',  // Yellow for slightly negative
                                'rgba(40, 167, 69, 0.7)',  // Green for positive
                                'rgba(40, 167, 69, 0.7)',
                                'rgba(40, 167, 69, 0.7)'
                            ],
                            borderColor: [
                                'rgba(220, 53, 69, 1)',
                                'rgba(255, 193, 7, 1)',
                                'rgba(40, 167, 69, 1)',
                                'rgba(40, 167, 69, 1)',
                                'rgba(40, 167, 69, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }

            // Statistics
            if (data.statistics) {
                const stats = data.statistics;
                document.getElementById('distributionStats').innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div><strong>Min:</strong> ${stats.min.toFixed(2)}%</div>
                        <div><strong>Max:</strong> ${stats.max.toFixed(2)}%</div>
                        <div><strong>Mean:</strong> ${stats.mean.toFixed(2)}%</div>
                        <div><strong>Median:</strong> ${stats.median.toFixed(2)}%</div>
                        <div><strong>Q1:</strong> ${stats.q1.toFixed(2)}%</div>
                        <div><strong>Q3:</strong> ${stats.q3.toFixed(2)}%</div>
                        <div><strong>Std Dev:</strong> ${stats.std_dev.toFixed(2)}%</div>
                    </div>
                `;
            }

            // Heatmap
            if (data.heatmap_data && data.heatmap_data.length > 0) {
                let html = '<table class="trades-table" style="font-size: 0.9em;"><thead><tr><th>Symbol</th><th>Strategy</th><th>Count</th><th>Avg Return</th></tr></thead><tbody>';
                data.heatmap_data.forEach(item => {
                    const returnClass = item.avg_return >= 0 ? 'positive' : 'negative';
                    html += `
                        <tr>
                            <td>${escapeHtml(item.symbol)}</td>
                            <td>${escapeHtml(item.strategy_type)}</td>
                            <td>${item.count}</td>
                            <td class="${returnClass}">${item.avg_return.toFixed(2)}%</td>
                        </tr>
                    `;
                });
                html += '</tbody></table>';
                document.getElementById('heatmapContainer').innerHTML = html;
            } else {
                document.getElementById('heatmapContainer').innerHTML = '<div class="empty-state"><p>No heatmap data available</p></div>';
            }
        }

        async function loadParameterInsights() {
            try {
                const queryParams = new URLSearchParams();
                if (currentFilters.symbol) queryParams.append('symbol', currentFilters.symbol);
                if (currentFilters.strategy_type) queryParams.append('strategy_type', currentFilters.strategy_type);
                if (currentFilters.start_date) queryParams.append('start_date', currentFilters.start_date);
                if (currentFilters.end_date) queryParams.append('end_date', currentFilters.end_date);

                const response = await authFetch(`/api/backtesting/walk-forward/dashboard/parameter-insights?${queryParams}`);
                if (!response.ok) throw new Error('Failed to load parameter insights');

                const data = await response.json();
                displayParameterInsights(data);
            } catch (error) {
                console.error('Error loading parameter insights:', error);
                document.getElementById('parameterInsightsContent').innerHTML = 
                    '<div class="empty-state"><p>Error loading parameter insights</p></div>';
            }
        }

        function displayParameterInsights(data) {
            const container = document.getElementById('parameterInsightsContent');
            let html = '';

            // Parameter performance
            if (data.parameter_performance && Object.keys(data.parameter_performance).length > 0) {
                html += '<div style="margin-bottom: 30px;"><h3 style="margin-bottom: 15px;">Best Parameter Values</h3>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">';
                
                for (const [paramName, insight] of Object.entries(data.parameter_performance)) {
                    html += `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea;">
                            <div style="font-weight: 600; margin-bottom: 5px;">${escapeHtml(paramName)}</div>
                            <div style="font-size: 1.2em; color: #667eea; font-weight: bold;">${escapeHtml(String(insight.best_value))}</div>
                            <div style="font-size: 0.85em; color: #666; margin-top: 5px;">
                                Avg Return: ${insight.best_avg_return.toFixed(2)}%<br>
                                Used in ${insight.total_occurrences} analyses
                            </div>
                        </div>
                    `;
                }
                html += '</div></div>';
            }

            // Training period insights
            if (data.training_period_insights && data.training_period_insights.best_period) {
                html += '<div style="margin-bottom: 30px;"><h3 style="margin-bottom: 15px;">Training Period Insights</h3>';
                html += `
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                        <div style="font-weight: 600; margin-bottom: 5px;">Best Training Period</div>
                        <div style="font-size: 1.2em; color: #28a745; font-weight: bold;">${data.training_period_insights.best_period} days</div>
                        <div style="font-size: 0.85em; color: #666; margin-top: 5px;">
                            Average Return: ${data.training_period_insights.best_avg_return.toFixed(2)}%
                        </div>
                    </div>
                `;
                html += '</div>';
            }

            // Window type insights
            if (data.window_type_insights && Object.keys(data.window_type_insights).length > 0) {
                html += '<div style="margin-bottom: 30px;"><h3 style="margin-bottom: 15px;">Window Type Insights</h3>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';
                
                for (const [windowType, insight] of Object.entries(data.window_type_insights)) {
                    const returnClass = insight.avg_return >= 0 ? 'positive' : 'negative';
                    html += `
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 5px;">${escapeHtml(windowType)}</div>
                            <div style="font-size: 1.2em; ${returnClass === 'positive' ? 'color: #28a745;' : 'color: #dc3545;'} font-weight: bold;">
                                ${insight.avg_return.toFixed(2)}%
                            </div>
                            <div style="font-size: 0.85em; color: #666; margin-top: 5px;">
                                ${insight.count} analyses
                            </div>
                        </div>
                    `;
                }
                html += '</div></div>';
            }

            if (html === '') {
                container.innerHTML = '<div class="empty-state"><p>No parameter insights available. Run more analyses to see insights.</p></div>';
            } else {
                container.innerHTML = html;
            }
        }

        async function loadTrends() {
            try {
                const queryParams = new URLSearchParams();
                if (currentFilters.symbol) queryParams.append('symbol', currentFilters.symbol);
                if (currentFilters.strategy_type) queryParams.append('strategy_type', currentFilters.strategy_type);
                if (currentFilters.start_date) queryParams.append('start_date', currentFilters.start_date);
                if (currentFilters.end_date) queryParams.append('end_date', currentFilters.end_date);

                const response = await authFetch(`/api/backtesting/walk-forward/dashboard/trends?${queryParams}`);
                if (!response.ok) throw new Error('Failed to load trends');

                const data = await response.json();
                displayTrends(data);
            } catch (error) {
                console.error('Error loading trends:', error);
            }
        }

        function displayTrends(data) {
            // Main trends chart
            const ctx = document.getElementById('trendsChart');
            if (ctx && data.time_series && data.time_series.length > 0) {
                if (trendsChart) {
                    trendsChart.destroy();
                }
                
                trendsChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.time_series.map(d => d.period),
                        datasets: [{
                            label: 'Average Return %',
                            data: data.time_series.map(d => d.avg_return),
                            borderColor: 'rgb(102, 126, 234)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }

            // Strategy trends chart
            const strategyCtx = document.getElementById('strategyTrendsChart');
            if (strategyCtx && data.by_strategy_type) {
                if (strategyTrendsChart) {
                    strategyTrendsChart.destroy();
                }
                
                const strategies = Object.keys(data.by_strategy_type);
                if (strategies.length > 0) {
                    const datasets = strategies.map((strategy, index) => {
                        const colors = [
                            'rgb(102, 126, 234)',
                            'rgb(40, 167, 69)',
                            'rgb(255, 193, 7)',
                            'rgb(220, 53, 69)'
                        ];
                        return {
                            label: strategy,
                            data: data.by_strategy_type[strategy].map(d => d.avg_return),
                            borderColor: colors[index % colors.length],
                            backgroundColor: colors[index % colors.length].replace('rgb', 'rgba').replace(')', ', 0.1)'),
                            tension: 0.4
                        };
                    });
                    
                    const allPeriods = new Set();
                    strategies.forEach(s => {
                        data.by_strategy_type[s].forEach(d => allPeriods.add(d.period));
                    });
                    const sortedPeriods = Array.from(allPeriods).sort();
                    
                    strategyTrendsChart = new Chart(strategyCtx, {
                        type: 'line',
                        data: {
                            labels: sortedPeriods,
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    display: true
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    });
                }
            }

            // Symbol trends chart
            const symbolCtx = document.getElementById('symbolTrendsChart');
            if (symbolCtx && data.by_symbol) {
                if (symbolTrendsChart) {
                    symbolTrendsChart.destroy();
                }
                
                const symbols = Object.keys(data.by_symbol);
                if (symbols.length > 0) {
                    symbolTrendsChart = new Chart(symbolCtx, {
                        type: 'bar',
                        data: {
                            labels: symbols,
                            datasets: [{
                                label: 'Average Return %',
                                data: symbols.map(s => data.by_symbol[s].avg_return),
                                backgroundColor: symbols.map(s => 
                                    data.by_symbol[s].avg_return >= 0 ? 'rgba(40, 167, 69, 0.7)' : 'rgba(220, 53, 69, 0.7)'
                                ),
                                borderColor: symbols.map(s => 
                                    data.by_symbol[s].avg_return >= 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)'
                                ),
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    });
                }
            }
        }

        async function loadAnalysisListForComparison() {
            try {
                console.log('Loading analysis list for comparison...');
                // API has max limit of 100, so we'll fetch in batches if needed
                let allAnalyses = [];
                let offset = 0;
                const limit = 100; // Maximum allowed by API
                let hasMore = true;
                
                // Fetch all analyses in batches
                while (hasMore) {
                    const response = await authFetch(`/api/backtesting/walk-forward/history?limit=${limit}&offset=${offset}`);
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Failed to load analyses:', response.status, errorText);
                        throw new Error(`Failed to load analyses: ${response.status} ${errorText}`);
                    }
                    
                    const data = await response.json();
                    const analyses = data.analyses || [];
                    allAnalyses = allAnalyses.concat(analyses);
                    
                    // Check if there are more to fetch
                    // Stop if: we got fewer than requested, or we've fetched all available
                    const totalAvailable = data.total || 0;
                    if (analyses.length < limit || (totalAvailable > 0 && allAnalyses.length >= totalAvailable)) {
                        hasMore = false;
                    } else {
                        offset += limit;
                        // Safety check: prevent infinite loops
                        if (offset > 10000) {
                            console.warn('Reached safety limit for pagination, stopping');
                            hasMore = false;
                        }
                    }
                }
                
                console.log(`Found ${allAnalyses.length} total analyses to populate dropdowns`);
                
                if (allAnalyses.length === 0) {
                    console.warn('No analyses found to populate comparison dropdowns');
                    // Show message in dropdowns
                    for (let i = 1; i <= 5; i++) {
                        const select = document.getElementById(`compareAnalysis${i}`);
                        if (select) {
                            select.innerHTML = '<option value="">No analyses available</option>';
                        }
                    }
                    return;
                }
                
                // Sort analyses by created date (newest first) for better UX
                allAnalyses.sort((a, b) => {
                    try {
                        const dateA = a.created_at ? new Date(a.created_at).getTime() : 0;
                        const dateB = b.created_at ? new Date(b.created_at).getTime() : 0;
                        return dateB - dateA; // Newest first
                    } catch (e) {
                        return 0; // Keep original order if date parsing fails
                    }
                });
                
                // Populate all comparison dropdowns
                for (let i = 1; i <= 5; i++) {
                    const select = document.getElementById(`compareAnalysis${i}`);
                    if (select) {
                        // Clear and add default option
                        select.innerHTML = '<option value="">Select analysis...</option>';
                        
                        // Add all analyses
                        allAnalyses.forEach(analysis => {
                            try {
                                const option = document.createElement('option');
                                option.value = analysis.id;
                                const name = analysis.name || 'Unnamed Analysis';
                                
                                // Safe date parsing
                                let dateStr = 'Unknown';
                                try {
                                    if (analysis.created_at) {
                                        dateStr = new Date(analysis.created_at).toLocaleDateString();
                                    }
                                } catch (e) {
                                    console.warn('Error parsing date for analysis:', analysis.id, e);
                                }
                                
                                // Safe number formatting
                                const returnPct = analysis.total_return_pct !== null && analysis.total_return_pct !== undefined 
                                    ? analysis.total_return_pct.toFixed(2) 
                                    : 'N/A';
                                
                                option.textContent = `${name} (${analysis.symbol || 'N/A'}, ${returnPct}%, ${dateStr})`;
                                select.appendChild(option);
                            } catch (e) {
                                console.error('Error creating option for analysis:', analysis.id, e);
                            }
                        });
                        
                        console.log(`Populated dropdown ${i} with ${allAnalyses.length} options`);
                    } else {
                        console.error(`Dropdown compareAnalysis${i} not found`);
                    }
                }
            } catch (error) {
                console.error('Error loading analysis list for comparison:', error);
                // Show error in dropdowns
                for (let i = 1; i <= 5; i++) {
                    const select = document.getElementById(`compareAnalysis${i}`);
                    if (select) {
                        select.innerHTML = `<option value="">Error loading analyses</option>`;
                    }
                }
            }
        }

        async function loadComparison() {
            const ids = [];
            for (let i = 1; i <= 5; i++) {
                const select = document.getElementById(`compareAnalysis${i}`);
                if (select && select.value) {
                    ids.push(select.value);
                }
            }
            
            if (ids.length < 2) {
                alert('Please select at least 2 analyses to compare');
                return;
            }
            
            if (ids.length > 5) {
                alert('Please select at most 5 analyses to compare');
                return;
            }
            
            try {
                const container = document.getElementById('comparisonResults');
                container.innerHTML = '<div class="loading">Loading comparison...</div>';
                
                const analyses = [];
                for (const id of ids) {
                    const response = await authFetch(`/api/backtesting/walk-forward/history/${id}`);
                    if (!response.ok) {
                        throw new Error(`Failed to load analysis ${id}`);
                    }
                    analyses.push(await response.json());
                }
                
                displayComparison(analyses);
            } catch (error) {
                console.error('Error loading comparison:', error);
                document.getElementById('comparisonResults').innerHTML = 
                    '<div class="empty-state"><p>Error loading comparison: ' + error.message + '</p></div>';
            }
        }

        function displayComparison(analyses) {
            const container = document.getElementById('comparisonResults');
            
            let html = '<table class="trades-table"><thead><tr><th>Metric</th>';
            analyses.forEach((analysis, index) => {
                html += `<th>${escapeHtml(analysis.name || `Analysis ${index + 1}`)}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            const metrics = [
                { label: 'Symbol', getValue: a => a.symbol || 'N/A' },
                { label: 'Strategy Type', getValue: a => a.strategy_type || 'N/A' },
                { label: 'Total Return %', getValue: a => {
                    if (a.total_return_pct === null || a.total_return_pct === undefined) return 'N/A';
                    return a.total_return_pct.toFixed(2) + '%';
                }, class: a => {
                    if (a.total_return_pct === null || a.total_return_pct === undefined) return '';
                    return a.total_return_pct >= 0 ? 'positive' : 'negative';
                }},
                { label: 'Consistency Score', getValue: a => {
                    if (a.consistency_score === null || a.consistency_score === undefined) return 'N/A';
                    return a.consistency_score.toFixed(1) + '%';
                }},
                { label: 'Sharpe Ratio', getValue: a => a.sharpe_ratio ? a.sharpe_ratio.toFixed(2) : 'N/A' },
                { label: 'Max Drawdown %', getValue: a => a.max_drawdown_pct ? a.max_drawdown_pct.toFixed(2) + '%' : 'N/A' },
                { label: 'Total Trades', getValue: a => a.total_trades || 0 },
                { label: 'Avg Win Rate', getValue: a => {
                    if (a.avg_win_rate === null || a.avg_win_rate === undefined) return 'N/A';
                    return a.avg_win_rate.toFixed(1) + '%';
                }},
                { label: 'Total Windows', getValue: a => a.total_windows || 0 },
                { label: 'Created', getValue: a => {
                    if (!a.created_at) return 'N/A';
                    try {
                        return new Date(a.created_at).toLocaleDateString();
                    } catch (e) {
                        return 'Invalid Date';
                    }
                }}
            ];
            
            metrics.forEach(metric => {
                html += '<tr><td><strong>' + escapeHtml(metric.label) + '</strong></td>';
                analyses.forEach(analysis => {
                    const value = metric.getValue(analysis);
                    const className = metric.class ? metric.class(analysis) : '';
                    html += `<td class="${className}">${escapeHtml(String(value))}</td>`;
                });
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function clearComparison() {
            for (let i = 1; i <= 5; i++) {
                const select = document.getElementById(`compareAnalysis${i}`);
                if (select) {
                    select.value = '';
                }
            }
            document.getElementById('comparisonResults').innerHTML = 
                '<div class="empty-state">' +
                '<p>Select at least 2 analyses from the dropdowns above to compare</p>' +
                '<p style="font-size: 0.85em; margin-top: 10px; color: #999;">' +
                '<strong>What gets compared?</strong><br>' +
                '‚Ä¢ Total Return % | ‚Ä¢ Consistency Score | ‚Ä¢ Sharpe Ratio<br>' +
                '‚Ä¢ Max Drawdown % | ‚Ä¢ Total Trades | ‚Ä¢ Win Rate<br>' +
                '‚Ä¢ Total Windows | ‚Ä¢ Symbol | ‚Ä¢ Strategy Type | ‚Ä¢ Created Date' +
                '</p>' +
                '</div>';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>

